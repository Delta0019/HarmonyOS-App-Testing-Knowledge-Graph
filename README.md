# HarmonyOS App Testing Knowledge Graph

é¸¿è’™ç³»ç»ŸAppè‡ªåŠ¨åŒ–æµ‹è¯•çŸ¥è¯†å›¾è°±ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºçŸ¥è¯†å›¾è°±çš„Appè‡ªåŠ¨åŒ–æµ‹è¯•è¾…åŠ©ç³»ç»Ÿï¼Œé€šè¿‡æ„å»ºAppé¡µé¢è½¬æ¢å›¾è°±å’Œæ„å›¾-è·¯å¾„æ˜ å°„ï¼Œä¸ºGUI Agentæä¾›æ™ºèƒ½è·¯å¾„è§„åˆ’å’Œæ“ä½œæ¨èã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
harmonyos_kg/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.yaml              # é…ç½®æ–‡ä»¶ï¼ˆæ•°æ®åº“ã€æ¨¡å‹ã€APIç­‰ï¼‰
â”‚
â”œâ”€â”€ kg_core/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ schema.py                # å®ä½“å’Œå…³ç³»å®šä¹‰ï¼ˆPage, Widget, Transition, Intentç­‰ï¼‰
â”‚   â”œâ”€â”€ graph_store.py           # å›¾æ•°æ®åº“æ“ä½œï¼ˆæ”¯æŒNeo4jå’Œå†…å­˜æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ vector_store.py          # å‘é‡æ•°æ®åº“æ“ä½œï¼ˆæ”¯æŒMilvuså’Œå†…å­˜æ¨¡å¼ï¼‰
â”‚   â””â”€â”€ embeddings.py            # åµŒå…¥æ¨¡å‹å°è£…ï¼ˆæ–‡æœ¬/å›¾åƒåµŒå…¥ï¼‰
â”‚
â”œâ”€â”€ kg_builder/                  # å›¾è°±æ„å»ºæ¨¡å—
â”‚   â””â”€â”€ graph_builder.py         # å›¾è°±æ„å»ºå™¨ï¼ˆé¡µé¢æ·»åŠ ã€å…³ç³»å»ºç«‹ï¼‰
â”‚
â”œâ”€â”€ kg_query/                    # æŸ¥è¯¢æ¨¡å—
â”‚   â”œâ”€â”€ path_finder.py           # è·¯å¾„æŸ¥è¯¢ï¼ˆåŸºäºæ„å›¾æŸ¥æ‰¾æ“ä½œè·¯å¾„ï¼‰
â”‚   â”œâ”€â”€ page_matcher.py          # é¡µé¢åŒ¹é…ï¼ˆUIæ ‘/æ ‡é¢˜åŒ¹é…ï¼‰
â”‚   â””â”€â”€ rag_engine.py            # RAGå¼•æ“ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ agent_interface/             # Agentå¯¹æ¥å±‚ â­
â”‚   â””â”€â”€ kg_client.py             # KGClientï¼ˆGUI Agentç»Ÿä¸€æ¥å£ï¼‰
â”‚
â”œâ”€â”€ api/                         # REST APIæœåŠ¡
â”‚   â””â”€â”€ routes.py                # FastAPIè·¯ç”±ï¼ˆåŒ…å«è¯·æ±‚/å“åº”æ¨¡å‹ï¼‰
â”‚
â”œâ”€â”€ examples/                    # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ demo_build_graph.py      # æ„å»ºå›¾è°±ç¤ºä¾‹
â”‚   â””â”€â”€ demo_with_agent.py       # Agentå¯¹æ¥ç¤ºä¾‹
â”‚
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ QUICKSTART.md                # å¿«é€Ÿå¼€å§‹æŒ‡å—
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. çŸ¥è¯†å›¾è°±æ„å»º
- **é¡µé¢èŠ‚ç‚¹ç®¡ç†**ï¼šè®°å½•Appé¡µé¢åŠå…¶å±æ€§ï¼ˆç±»å‹ã€æ ‡é¢˜ã€æè¿°ã€æ„å›¾ç­‰ï¼‰
- **è½¬æ¢å…³ç³»å»ºæ¨¡**ï¼šè®°å½•é¡µé¢é—´çš„è½¬æ¢è·¯å¾„å’Œè§¦å‘æ“ä½œ
- **æ„å›¾æ³¨å†Œ**ï¼šå°†ç”¨æˆ·æ„å›¾ä¸ç›®æ ‡é¡µé¢/è·¯å¾„å…³è”

### 2. æ™ºèƒ½è·¯å¾„æŸ¥è¯¢
- **æ„å›¾åˆ°è·¯å¾„**ï¼šæ ¹æ®ç”¨æˆ·æ„å›¾ï¼ˆå¦‚"ç‚¹å¤–å–"ï¼‰æŸ¥æ‰¾æ“ä½œè·¯å¾„
- **ä¸‹ä¸€æ­¥æ¨è**ï¼šåŸºäºå½“å‰é¡µé¢å’Œæ„å›¾æ¨èä¸‹ä¸€æ­¥æ“ä½œ
- **è·¯å¾„ä¼˜åŒ–**ï¼šè€ƒè™‘æˆåŠŸç‡ã€æ­¥éª¤æ•°ç­‰å› ç´ é€‰æ‹©æœ€ä¼˜è·¯å¾„

### 3. é¡µé¢åŒ¹é…
- **UIæ ‘åŒ¹é…**ï¼šåŸºäºUIå±‚æ¬¡ç»“æ„åŒ¹é…å½“å‰é¡µé¢
- **è¯­ä¹‰åŒ¹é…**ï¼šä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦åŒ¹é…é¡µé¢

### 4. RAGå¢å¼º
- **ä¸Šä¸‹æ–‡æ£€ç´¢**ï¼šä¸ºLLMå†³ç­–æä¾›ç›¸å…³é¡µé¢å’Œæ“ä½œä¿¡æ¯
- **æç¤ºè¯ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”ŸæˆåŒ…å«å›¾è°±çŸ¥è¯†çš„æç¤ºè¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

**æ ¸å¿ƒä¾èµ–**ï¼š
- `networkx` - å†…å­˜å›¾æ•°æ®åº“ï¼ˆDemoæ¨¡å¼ï¼‰
- `numpy` - å‘é‡è®¡ç®—
- `pydantic` - æ•°æ®éªŒè¯
- `sentence-transformers` - æ–‡æœ¬åµŒå…¥ï¼ˆå¯é€‰ï¼‰
- `fastapi` + `uvicorn` - APIæœåŠ¡ï¼ˆå¯é€‰ï¼‰
- `neo4j` - å›¾æ•°æ®åº“ï¼ˆç”Ÿäº§æ¨¡å¼ï¼Œå¯é€‰ï¼‰

### 2. é…ç½®

ç¼–è¾‘ `config/config.yaml`ï¼š

```yaml
# è¿è¡Œæ¨¡å¼: memoryï¼ˆå†…å­˜æ¨¡å¼ï¼Œç”¨äºDemoï¼‰| productionï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
mode: memory

# å›¾æ•°æ®åº“é…ç½®
graph_db:
  type: memory  # neo4j | memory

# å‘é‡æ•°æ®åº“é…ç½®
vector_db:
  type: memory  # milvus | memory
```

### 3. è¿è¡Œç¤ºä¾‹

```bash
# æ„å»ºå›¾è°±ç¤ºä¾‹
python examples/demo_build_graph.py

# Agentå¯¹æ¥ç¤ºä¾‹
python examples/demo_with_agent.py
```

## ğŸ”Œ ä¸GUI Agentå¯¹æ¥

### æ–¹å¼1: ç›´æ¥ä½¿ç”¨KGClientï¼ˆæ¨èï¼‰

```python
from agent_interface.kg_client import KGClient

# åˆå§‹åŒ–å®¢æˆ·ç«¯
kg = KGClient()

# 1. æŸ¥è¯¢å®Œæ•´æ“ä½œè·¯å¾„
result = kg.query_path(
    app_id="com.meituan.app",
    intent="ç‚¹å¤–å–",
    current_page="home_page_id",
    max_steps=10
)

if result["success"]:
    for step in result["path"]["steps"]:
        # stepåŒ…å«: action, widget_id, widget_text, expected_page
        execute_action(step["action"], step["widget_id"])

# 2. è·å–ä¸‹ä¸€æ­¥æ“ä½œï¼ˆå®æ—¶æ¨¡å¼ï¼‰
action = kg.get_next_action(
    current_page="current_page_id",
    intent="ç‚¹å¤–å–",
    app_id="com.meituan.app"
)
if action:
    execute_action(action.action_type, action.widget_id)

# 3. åŒ¹é…å½“å‰é¡µé¢
page_info = kg.match_current_page(
    app_id="com.meituan.app",
    ui_hierarchy={"widgets": [...]},  # UIæ ‘ç»“æ„
    page_title="é¦–é¡µ"
)

# 4. ä¸ŠæŠ¥æ‰§è¡Œç»“æœï¼ˆå›¾è°±å­¦ä¹ ï¼‰
kg.report_transition(
    from_page="page_a",
    action={"type": "click", "widget": "btn_id"},
    to_page="page_b",
    success=True,
    latency_ms=500
)

# 5. è·å–RAGä¸Šä¸‹æ–‡ï¼ˆä¾›LLMå†³ç­–ï¼‰
context = kg.get_rag_context(
    app_id="com.meituan.app",
    query="ç‚¹å¤–å–",
    current_page="home_page_id"
)
llm_prompt = context["prompt"]  # ç›´æ¥ä¼ ç»™LLM
```

### æ–¹å¼2: REST APIè°ƒç”¨

```bash
# å¯åŠ¨APIæœåŠ¡
python -m api.routes

# æŸ¥è¯¢è·¯å¾„
curl -X POST http://localhost:8000/api/v1/query/path \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "com.meituan.app",
    "intent": "ç‚¹å¤–å–",
    "current_page_id": "home_page_id"
  }'

# è·å–ä¸‹ä¸€æ­¥æ“ä½œ
curl -X POST http://localhost:8000/api/v1/query/next-action \
  -H "Content-Type: application/json" \
  -d '{
    "current_page_id": "current_page_id",
    "intent": "ç‚¹å¤–å–",
    "app_id": "com.meituan.app"
  }'

# æŸ¥çœ‹APIæ–‡æ¡£
# è®¿é—® http://localhost:8000/docs
```

## ğŸ“Š æ ¸å¿ƒæ•°æ®æ¨¡å‹

### å®ä½“ç±»å‹
- **App**: åº”ç”¨ï¼ˆapp_id, app_name, versionï¼‰
- **Page**: é¡µé¢ï¼ˆpage_id, page_name, page_type, description, intentsï¼‰
- **Widget**: æ§ä»¶ï¼ˆwidget_id, widget_type, text, xpath, boundsï¼‰
- **Intent**: æ„å›¾ï¼ˆintent_id, intent_text, keywordsï¼‰
- **ActionPath**: æ“ä½œè·¯å¾„ï¼ˆpath_id, steps, confidenceï¼‰

### å…³ç³»ç±»å‹
- **TRANSITIONS_TO**: é¡µé¢è½¬æ¢ï¼ˆsource_page â†’ target_pageï¼ŒåŒ…å«è§¦å‘æ“ä½œï¼‰
- **ACHIEVES_INTENT**: å®ç°æ„å›¾ï¼ˆActionPath â†’ Intentï¼‰

## ğŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       GUI Agent                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ¥æ”¶æµ‹è¯•ä»»åŠ¡: "ç‚¹å¤–å–"                                    â”‚
â”‚  2. è·å–å½“å‰é¡µé¢çŠ¶æ€ (UIæ ‘/æˆªå›¾)                              â”‚
â”‚  3. è°ƒç”¨ kg.query_path() è·å–æ“ä½œè·¯å¾„                        â”‚
â”‚  4. é€æ­¥æ‰§è¡Œæ“ä½œ:                                            â”‚
â”‚     - æ‰§è¡Œ step["action"] on step["widget_id"]             â”‚
â”‚     - è°ƒç”¨ kg.report_transition() ä¸ŠæŠ¥ç»“æœ                  â”‚
â”‚  5. ä»»åŠ¡å®Œæˆ                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KGClient (å¯¹æ¥å±‚)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ query_path()      â†’ PathFinder.find_path_by_intent()    â”‚
â”‚  â€¢ get_next_action() â†’ PathFinder.get_next_action()        â”‚
â”‚  â€¢ match_current_page() â†’ PageMatcher.match()              â”‚
â”‚  â€¢ get_rag_context() â†’ RAGEngine.retrieve()                â”‚
â”‚  â€¢ report_transition() â†’ GraphStore.update_transition()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å­˜å‚¨å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GraphStore (NetworkX/Neo4j)  â”‚  VectorStore (NumPy/Milvus) â”‚
â”‚  â€¢ é¡µé¢èŠ‚ç‚¹                  â”‚  â€¢ é¡µé¢å‘é‡                  â”‚
â”‚  â€¢ è½¬æ¢è¾¹                    â”‚  â€¢ æ„å›¾å‘é‡                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“– æ ¸å¿ƒæ¥å£è¯´æ˜

| æ–¹æ³•                                       | ç”¨é€”             | è¿”å›      |
| ------------------------------------------ | ---------------- | --------- |
| `query_path(app_id, intent, current_page)` | æŸ¥è¯¢å®Œæ•´æ“ä½œè·¯å¾„ | æ­¥éª¤åºåˆ—  |
| `get_next_action(current_page, intent)`    | è·å–ä¸‹ä¸€æ­¥æ“ä½œ   | å•ä¸ªæ“ä½œ  |
| `match_current_page(app_id, ui_hierarchy)` | åŒ¹é…å½“å‰é¡µé¢     | é¡µé¢ID    |
| `report_transition(from, action, to)`      | ä¸ŠæŠ¥è½¬æ¢ç»“æœ     | -         |
| `get_rag_context(app_id, query)`           | è·å–RAGä¸Šä¸‹æ–‡    | LLMæç¤ºè¯ |
| `add_page(app_id, page_name, ...)`         | æ·»åŠ é¡µé¢         | é¡µé¢ID    |
| `register_intent(app_id, intent_text)`     | æ³¨å†Œæ„å›¾         | æ„å›¾ID    |

## ğŸ› ï¸ å¼€å‘æ¨¡å¼

### å†…å­˜æ¨¡å¼ï¼ˆDemo/å¼€å‘ï¼‰
- ä½¿ç”¨ `NetworkX` ä½œä¸ºå†…å­˜å›¾æ•°æ®åº“
- ä½¿ç”¨ `NumPy` æ•°ç»„å­˜å‚¨å‘é‡
- æ— éœ€å¤–éƒ¨æ•°æ®åº“ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•

### ç”Ÿäº§æ¨¡å¼
- ä½¿ç”¨ `Neo4j` ä½œä¸ºå›¾æ•°æ®åº“
- ä½¿ç”¨ `Milvus` ä½œä¸ºå‘é‡æ•°æ®åº“
- æ”¯æŒæŒä¹…åŒ–å­˜å‚¨å’Œåˆ†å¸ƒå¼éƒ¨ç½²

## ğŸ“ æ›´å¤šæ–‡æ¡£

- [QUICKSTART.md](QUICKSTART.md) - è¯¦ç»†çš„å¿«é€Ÿå¼€å§‹æŒ‡å—å’Œé›†æˆç¤ºä¾‹

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºæ¯•ä¸šè®¾è®¡é¡¹ç›®ã€‚
